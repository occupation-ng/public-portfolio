{"version":3,"sources":["hipo/interceptor.cljs"],"mappings":"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","names":["hipo$interceptor$Interceptor$_intercept$dyn","x__5393__auto__","m__5394__auto__","hipo.interceptor/-intercept","goog/typeOf","m__5392__auto__","cljs.core/missing-protocol","hipo.interceptor/Interceptor","this","t","m","f","hipo.interceptor/call","v","i","cljs.core/first","s","cljs.core/rest","cljs.core/seq","cljs.core/PROTOCOL_SENTINEL","this__5330__auto__","writer__5331__auto__","opt__5332__auto__","cljs.core/-write","hipo.interceptor/LogInterceptor","hipo.interceptor/->LogInterceptor","b","_","cljs.core/not","cljs.core.not_EQ_","js/console","cljs.core/name","cljs.core/clj->js","hipo.interceptor/TimeInterceptor","hipo.interceptor/->TimeInterceptor","label","hipo.interceptor/ProfileInterceptor","hipo.interceptor/->ProfileInterceptor","cljs.core._EQ_","hipo.interceptor/PerformanceInterceptor","hipo.interceptor/->PerformanceInterceptor","mark-begin","mark-end","js/performance","hipo.interceptor/StateInterceptor","hipo.interceptor/->StateInterceptor","a","o","p1__20857#","p2__20856#","cljs.core.swap_BANG_","cljs.core/cons","hipo.interceptor/StaticReconciliationInterceptor","hipo.interceptor/->StaticReconciliationInterceptor","cljs.core/contains?","cljs.core/meta","hipo.interceptor/IdentityReconciliationInterceptor","hipo.interceptor/->IdentityReconciliationInterceptor"],"sourcesContent":["(ns hipo.interceptor\n  (:require-macros hipo.interceptor))\n\n(defprotocol Interceptor\n  (-intercept [this t m f]))\n\n(defn call\n  [f v t m]\n  (let [i (first v)]\n    (-intercept i t m #(let [s (rest v)]\n                        (if (seq s)\n                          (call f s t m)\n                          (f))))))\n\n(deftype LogInterceptor [b]\n  Interceptor\n  (-intercept [_ t m f]\n    (if (or (not b) (not= :reconciliate t))\n      (.log js/console (name t) \" \" (clj->js m)))\n    (f)))\n\n(deftype TimeInterceptor [s]\n  Interceptor\n  (-intercept [_ t _ f]\n    (let [label (str s \"-\" (name t))]\n      (.time js/console label)\n      (f)\n      (.timeEnd js/console label))))\n\n(deftype ProfileInterceptor [label]\n  Interceptor\n  (-intercept [_ t _ f]\n    (when (= t :reconciliate)\n      (.profile js/console label)\n      (f)\n      (.profileEnd js/console label))\n    (f)))\n\n(deftype PerformanceInterceptor [label]\n  Interceptor\n  ; http://w3c.github.io/user-timing/\n  (-intercept [_ t _ f]\n    (let [mark-begin (str label \" begin \" t)\n          mark-end (str label \" end \" t)]\n      (.mark js/performance mark-begin)\n      (f)\n      (.mark js/performance mark-end)\n      (.measure js/performance (str label \" \" t) mark-begin mark-end))))\n\n(deftype StateInterceptor [a]\n  Interceptor\n  (-intercept [_ t o f]\n    (swap! a #(cons %2 %1) {:type t :value o})\n    (f)))\n\n(deftype StaticReconciliationInterceptor []\n  Interceptor\n  (-intercept [_ t o f]\n    (if (= :reconciliate t)\n      (if-not (contains? (meta (:new-value o)) :hipo/static)\n        (f))\n      (f))))\n\n(deftype IdentityReconciliationInterceptor []\n  Interceptor\n  (-intercept [_ t o f]\n    (if (= :reconciliate t)\n      (if-not (identical? (:old-value o) (:new-value o))\n        (f))\n      (f))))\n"]}